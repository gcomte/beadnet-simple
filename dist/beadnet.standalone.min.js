!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.beadnet=t()}(this,function(){"use strict";var e=["Aarya","Addison","Adrian","Aiden","Ainsley","Alby","Alex","Alexis","Ali","Amari","Andy","Angel","Archer","Ari","Arya","Ash","Ashley","Aspen","Aubrey","August","Austen","Avery","Bailey","Bay","Billy","Blaine","Blair","Blake","Bobbie","Brady","Brett","Brook","Brooklyn","Caelan","Cameron","Campbell","Carmen","Carroll","Carson","Casey","Cassidy","Celyn","Charlie","Chris","Clay","Cody","Corey","Dakota","Dale","Dallas","Dana","Dane","Darrel","Daryl","Delta","Devin","Devon","Dorian","Drew","Dylan","Easton","Eddie","Eden","Eli","Ellery","Elliott","Emerson","Emery","Erin","Fabian","Finley","Florian","Flynn","Frances","Francis","Frankie","Gabriel","Glenn","Gray","Hadley","Harley","Harper","Hayden","Hero","Hudson","Hunter","Indiana","Jade","James","Jamie","Jayden","Jean","Jesse","Jessie","Jordan","Jules","Julian","Justice","Kaden","Kadin","Kai","Karter","Keegan","Kelly","Kelsey","Kendall","Kennedy","Kerry","Kyle","Lake","Landry","Lane","Lee","Lincoln","Linden","Logan","London","Lonnie","Lou","Lucian","Lumi","Mackenzie","Madison","Marley","Mason","Max","Maxwell","Micah","Monroe","Montana","Morgan","Moriah","Nevada","Nico","Noel","Oakley","Ode","Ore","Paris","Parker","Pat","Payton","Perry","Peyton","Phoenix","Piper","Quinn","Raphael","Ray","Reagan","Reed","Reese","Remy","Riley","River","Roan","Robin","Rory","Roux","Rowan","Rudy","Ryan","Sage","Sam","Samar","Sawyer","Scout","Sean","Shawn","Sky","Skylar","Spencer","Stevie","Sunny","Sydney","Tanner","Tatum","Taylor","Terry","Toby","Toni","Tory","Tru","Tyler","Umber","Unique","Val","Vesper","Wallace","West","Winter","Wyatt","Wynne","Xen","Xoan","Yael","Zion"];function t(){return e[Math.floor(Math.random()*e.length)]}var a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var n,r=(function(e){var t,n;t=a,n=function(){var r=function(){},l="undefined",c=["trace","debug","info","warn","error"];function o(t,e){var n=t[e];if("function"==typeof n.bind)return n.bind(t);try{return Function.prototype.bind.call(n,t)}catch(e){return function(){return Function.prototype.apply.apply(n,[t,arguments])}}}function h(e,t){for(var n=0;n<c.length;n++){var a=c[n];this[a]=n<e?r:this.methodFactory(a,e,t)}this.log=this.debug}function d(e,t,n){return"debug"===(a=e)&&(a="log"),typeof console!==l&&(void 0!==console[a]?o(console,a):void 0!==console.log?o(console,"log"):r)||function(e,t,n){return function(){typeof console!==l&&(h.call(this,t,n),this[e].apply(this,arguments))}}.apply(this,arguments);var a}function n(n,e,t){var a,r=this,o="loglevel";function i(){var e;if(typeof window!==l){try{e=window.localStorage[o]}catch(e){}if(typeof e===l)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(o)+"=");-1!==n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===r.levels[e]&&(e=void 0),e}}n&&(o+=":"+n),r.name=n,r.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},r.methodFactory=t||d,r.getLevel=function(){return a},r.setLevel=function(e,t){if("string"==typeof e&&void 0!==r.levels[e.toUpperCase()]&&(e=r.levels[e.toUpperCase()]),!("number"==typeof e&&0<=e&&e<=r.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;if(a=e,!1!==t&&function(e){var t=(c[e]||"silent").toUpperCase();if(typeof window!==l){try{return window.localStorage[o]=t}catch(e){}try{window.document.cookie=encodeURIComponent(o)+"="+t+";"}catch(e){}}}(e),h.call(r,e,n),typeof console===l&&e<r.levels.SILENT)return"No console available for logging"},r.setDefaultLevel=function(e){i()||r.setLevel(e,!1)},r.enableAll=function(e){r.setLevel(r.levels.TRACE,e)},r.disableAll=function(e){r.setLevel(r.levels.SILENT,e)};var s=i();null==s&&(s=null==e?"WARN":e),r.setLevel(s,!1)}var a=new n,i={};a.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new n(e,a.getLevel(),a.methodFactory)),t};var e=typeof window!==l?window.log:void 0;return a.noConflict=function(){return typeof window!==l&&window.log===a&&(window.log=e),a},a.getLoggers=function(){return i},a},e.exports?e.exports=n():t.log=n()}(n={exports:{}},n.exports),n.exports);r.enableAll(),r.setLevel("TRACE");var o=Object.prototype.hasOwnProperty,i=Object.prototype.toString,s=Object.defineProperty,l=Object.getOwnPropertyDescriptor,d=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===i.call(e)},u=function(e){if(!e||"[object Object]"!==i.call(e))return!1;var t,n=o.call(e,"constructor"),a=e.constructor&&e.constructor.prototype&&o.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!a)return!1;for(t in e);return void 0===t||o.call(e,t)},f=function(e,t){s&&"__proto__"===t.name?s(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},g=function(e,t){if("__proto__"===t){if(!o.call(e,t))return;if(l)return l(e,t).value}return e[t]},c=function e(){var t,n,a,r,o,i,s=arguments[0],l=1,c=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[1]||{},l=2),(null==s||"object"!=typeof s&&"function"!=typeof s)&&(s={});l<c;++l)if(null!=(t=arguments[l]))for(n in t)a=g(s,n),s!==(r=g(t,n))&&(h&&r&&(u(r)||(o=d(r)))?(i=o?(o=!1,a&&d(a)?a:[]):a&&u(a)?a:{},f(s,{name:n,newValue:e(h,i,r)})):void 0!==r&&f(s,{name:n,newValue:r}));return s},h={colorScheme:d3.scaleOrdinal(d3.schemeCategory20),debug:!1,container:{selector:"#beadnet",backgroundColor:"#FFF"},nodes:{radius:35,color:null,strokeWidth:3,strokeColor:null,text:"id"},channels:{color:"#ccc",colorHighlighted:null,strokeWidth:"auto",strokeColor:null,showBalance:!1},beads:{radius:10,spacing:-.5,strokeWidth:2,strokeColor:null,showIndex:!0},presentation:!1};var p=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),y=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},v=function(e){return Math.floor(Math.random()*e)},m={ADD_NODE:{fnName:"addNode",numArgs:1},ADD_NODES:{fnName:"addNodes",numArgs:1},REMOVE_NODE:{fnName:"removeNode",numArgs:1},ADD_CHANNEL:{fnName:"addChannel",numArgs:1},ADD_CHANNELS:{fnName:"addChannels",numArgs:1},REMOVE_CHANNEL:{fnName:"removeChannel",numArgs:2},CHANGE_CHANNEL_SOURCE_BALANCE:{fnName:"changeChannelSourceBalance",numArgs:3},CHANGE_CHANNEL_TARGET_BALANCE:{fnName:"changeChannelTargetBalance",numArgs:3},HIGHLIGHT_CHANNEL:{fnName:"highlightChannel",numArgs:3},MOVE_BEADS:{fnName:"moveBeads",numArgs:4},UPDATE_NODE:{fnName:"updateNode",numArgs:2}};return function(){function n(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this._opt=(c(!0,t={},h,e),t.nodes.color=t.nodes.color||t.colorScheme(0),t.nodes.strokeColor=t.nodes.strokeColor||t.container.backgroundColor,t.channels.color=t.channels.color||t.colorScheme(15),t.channels.colorHighlighted=t.channels.colorHighlighted||t.colorScheme(19),t.beads.color=t.beads.color||t.colorScheme(10),t.beads.strokeColor=t.beads.strokeColor||t.container.backgroundColor,t.beads.animation=t.beads.animation||d3.easeExp,t.beads.distance=2*t.beads.radius+t.beads.spacing+t.beads.strokeWidth,t.beads.firstPosition=t.nodes.radius+t.nodes.strokeWidth/2+t.beads.radius+t.beads.strokeWidth/2+t.beads.spacing,t.beads.showIndex=null===t.beads.showIndex?t.debug:t.beads.showIndex,t),r.debug("initializing beadnet with options: ",this._opt),this.container=document.querySelector(this._opt.container.selector),this.svg=d3.select(this.container).append("svg").attr("class","beadnet"),this.updateSVGSize(),this.chart=this.svg.append("g").attr("class","chart").attr("transform","translate(0,0) scale(1)"),this.channelContainer=this.chart.append("g").attr("class","channels"),this.nodeContainer=this.chart.append("g").attr("class","nodes"),this._nodes=[],this._channels=[],this.beadElements=[],this.simulation=this._createSimulation(),this.updateSimulationCenter(),this.behaviors=this.createBehaviors(),this.svg.call(this.behaviors.zoom),this._updateNodes(),this._opt.presentation&&this._initializePresentation(),window.addEventListener("resize",this.onResize.bind(this))}return p(n,[{key:"_getNodeById",value:function(t){return this._nodes.find(function(e){return e.id==t})}},{key:"_getChannelById",value:function(t){return this._channels.find(function(e){return e.id==t})}},{key:"_createSimulation",value:function(){return d3.forceSimulation(this._nodes).force("charge",d3.forceManyBody().strength(-7e3)).force("link",d3.forceLink(this._channels).strength(1).distance(this.forceDistance)).force("x",d3.forceX()).force("y",d3.forceY()).alphaTarget(0).on("tick",this._ticked.bind(this))}},{key:"updateSVGSize",value:function(){this.width=+this.container.clientWidth,this.height=+this.container.clientHeight,this.forceDistance=.2*(this.width+this.height),this.svg.attr("width",this.width).attr("height",this.height)}},{key:"onResize",value:function(){this.updateSVGSize(),this.updateSimulationCenter(),this.createBehaviors()}},{key:"createBehaviors",value:function(){var e=this;return{zoom:d3.zoom().scaleExtent([.1,5,4]).on("zoom",function(){return e.chart.attr("transform",d3.event.transform)}),drag:d3.drag().on("start",this._onDragStart.bind(this)).on("drag",this._onDragged.bind(this)).on("end",this._onDragendEnd.bind(this))}}},{key:"updateSimulationCenter",value:function(){var e=this.svg.attr("width")/2,t=this.svg.attr("height")/2;this.simulation.force("center",d3.forceCenter(e,t)).restart()}},{key:"_updateNodes",value:function(){var e=this._opt;console.log("_updateNodes: ",this._nodes),this._nodeElements=this.nodeContainer.selectAll(".node").data(this._nodes,function(e){return e.id}),this._nodeElements.exit().transition().duration(1e3).style("opacity",0).remove();var t=this._nodeElements.enter().append("g").attr("class","node").attr("id",function(e){return e.id}).attr("balance",function(e){return e.balance}).style("stroke",e.nodes.strokeColor).style("stroke-width",e.nodes.strokeWidth);return t.append("circle").attr("class","node-circle").attr("fill",function(e){return e.color}).attr("r",e.nodes.radius).style("stroke-width",0).style("cursor","pointer"),t.append("circle").attr("class","node-circle-onchain").attr("fill","#666").attr("r",.4*e.nodes.radius).attr("cx","-15px").attr("cy","-30px").style("stroke-width",0).style("cursor","pointer"),t.append("text").style("stroke-width",.5).attr("class","node-text-balance").attr("stroke",e.container.backgroundColor).attr("fill",e.container.backgroundColor).attr("font-family","bitcoinregular").attr("font-size","12px").attr("text-anchor","middle").attr("pointer-events","none").attr("x","-15px").attr("y","-26px").text(function(e){return"฿ "+e.balance}),t.append("text").style("stroke-width",.5).attr("class","node-text-id").attr("stroke",e.container.backgroundColor).attr("fill",e.container.backgroundColor).attr("font-family","sans-serif").attr("font-size","15px").attr("y","0px").attr("text-anchor","middle").attr("pointer-events","none").text(function(e){return e.id}),t.append("text").style("stroke-width",.5).attr("class","node-text-offchain-balance").attr("stroke",e.container.backgroundColor).attr("fill",e.container.backgroundColor).attr("font-family","sans-serif").attr("font-size","12px").attr("y","20px").attr("text-anchor","middle").attr("pointer-events","none").text(function(e){return"⚡ "+e.offchainBalance}),t.call(this.behaviors.drag),this._nodeElements.attr("offchain-balance",function(e){return e.offchainBalance}).selectAll(".node-text-offchain-balance").text(function(e){return"⚡ "+e.offchainBalance}),this._nodeElements.attr("balance",function(e){return e.balance}).selectAll(".node-text-balance").text(function(e){return"฿ "+e.balance}),this.simulation.nodes(this._nodes).alphaTarget(1).restart(),this._nodeElements=this.nodeContainer.selectAll(".node"),this._nodeElements}},{key:"addNode",value:function(e){return(e=e||{}).id=e.id||t(),e.balance=e.balance||v(100),e.offchainBalance=e.offchainBalance||0,e.color=this._opt.colorScheme(this._nodes.length%20+1),this._nodes.push(e),this._updateNodes(),this}},{key:"addNodes",value:function(e){var t=this;return e.forEach(function(e){return t.addNode(e)}),this}},{key:"updateNode",value:function(e,t){var n=this._getNodeById(e);return n&&(Objects.assign(n,t),this._updateNodes()),this}},{key:"removeNode",value:function(t){return this._nodes=this._nodes.filter(function(e){return e.id!==t}),this._channels=this._channels.filter(function(e){return e.source.id!==t&&e.target.id!==t}),this._updateNodes(),this._updateChannels(),this}},{key:"createRandomNodes",value:function(e){if(void 0!==e&&"number"!=typeof e||e<0)throw new TypeError("parameter count must be a positive number");return Array.from(new Array(e),function(e){return{id:t(),balance:v(100),offchainBalance:0}})}},{key:"getRandomNode",value:function(){return this._nodes[v(this._nodes.length)]}},{key:"_updateChannels",value:function(){var t=this._opt;this._channels=this._channels.map(function(t){var e,n,a=t.sourceBalance+t.targetBalance,r=-1;return t.beads=[],(e=t.beads).push.apply(e,y(Array.from(new Array(t.sourceBalance),function(e){return{state:0,index:++r,id:"bead_"+t.id+"_source_"+r+"x"+a}}))),(n=t.beads).push.apply(n,y(Array.from(new Array(t.targetBalance),function(e){return{state:1,index:++r,id:"bead_"+t.id+"_target_"+r+"x"+a}}))),t}),console.log("_updateChannels: ",this._channels),this._channelElements=this.channelContainer.selectAll(".channel").data(this._channels,function(e){return e.id}),this._channelElements.exit().transition().duration(500).style("opacity",0).remove();var e=this._channelElements.enter().append("g").attr("class","channel");this._channelElements.merge(e).attr("id",function(e){return e.id}).attr("source-balance",function(e){return e.sourceBalance}).attr("target-balance",function(e){return e.targetBalance}).attr("source-id",function(e){return e.source.id}).attr("target-id",function(e){return e.target.id}).attr("highlighted",function(e){return e.hightlighted}),e.append("path").attr("class","path").attr("id",function(e){return e.id+"_path"}).style("stroke-width",function(e){return"auto"===t.channels.strokeWidth?2*(e.sourceBalance+e.targetBalance):t.channels.strokeWidth}).style("stroke",t.channels.color).style("fill","none"),this._opt.channels.showBalance&&e.append("text").attr("class","channel-text").attr("font-family","Verdana").attr("font-size","12").attr("dx",150).attr("dy",-7).style("pointer-events","none").append("textPath").attr("xlink:href",function(e){return"#"+e.id+"_path"}).attr("class","channel-text-path").style("stroke-width",1).style("stroke",t.channels.color).style("fill","none").text(function(e){return e.sourceBalance+":"+e.targetBalance});var n=e.append("g").attr("class","beads").attr("id",function(e){return"beads_container"});this.beadElements=n.selectAll(".bead").data(function(e){return e.beads},function(e){return e.id}),this.beadElements.exit().transition().duration(800).style("opacity",0).remove();var a=this.beadElements.enter().append("g").attr("class","bead");return this.beadElements.merge(a).attr("channel-state",function(e){return e.state}).attr("id",function(e){return e.id}).attr("index",function(e){return e.index}),a.append("circle").attr("r",t.beads.radius).style("stroke-width",t.beads.strokeWidth).style("fill",t.beads.color).style("stroke",t.beads.strokeColor),t.beads.showIndex&&a.append("text").attr("class","bead-text").attr("stroke",t.container.backgroundColor).attr("fill",t.container.backgroundColor).attr("font-family","sans-serif").attr("font-size","8px").attr("y","2px").attr("text-anchor","middle").attr("pointer-events","none").style("stroke-width",.2).text(function(e){return e.index}),this._opt.channels.showBalance&&this._channelElements.selectAll(".channel-text-path").text(function(e){return e.sourceBalance+":"+e.targetBalance}),this._channelElements.selectAll("[highlighted=true] .path").style("stroke",t.channels.colorHighlighted),this._channelElements.selectAll("[highlighted=false] .path").style("stroke",t.channels.color),this._paths=this.channelContainer.selectAll(".channel .path"),this.beadElements=this.channelContainer.selectAll(".channel .beads .bead"),this.simulation.force("link").links(this._channels),this.simulation.alphaTarget(0).restart(),this._channelElements}},{key:"_getUniqueChannelId",value:function(e){for(var t=(+e.sourceBalance||0)+(+e.targetBalance||0),n=0,a="channel"+e.source+t+e.target+(0<n?n:"");0<this._channels.filter(function(e){return e.id===a}).length;)n++,a="channel"+e.source+t+e.target+(0<n?n:"");return a}},{key:"addChannel",value:function(e){if(e.sourceBalance=e.sourceBalance||0,e.targetBalance=e.targetBalance||0,!e.sourceBalance&&!e.targetBalance)throw new Error("Its not possible to create a channel without any funds. Please add a sourceBalance and/or targetBalance.");var t=this._getNodeById(e.source),n=this._getNodeById(e.target);if(t.balance<e.sourceBalance)throw new Error("Insufficient Funds. The source node has not enough funds to open this channel");if(n.balance<e.targetBalance)throw new Error("Insufficient Funds. The target node has not enough funds to open this channel");t.balance-=e.sourceBalance,t.offchainBalance+=e.sourceBalance,n.balance-=e.targetBalance,n.offchainBalance+=e.targetBalance,this._updateNodes();var a=this._getUniqueChannelId(e);return this._channels.push({id:a,hightlighted:!1,source:t,target:n,sourceBalance:e.sourceBalance,targetBalance:e.targetBalance}),this._updateChannels(),this}},{key:"addChannels",value:function(e){var t=this;e.forEach(function(e){return t.addChannel(e)})}},{key:"createRandomChannels",value:function(e){var s=this,l=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return Array.from(new Array(e),function(e){var t=s.getRandomNode(),n=s.getRandomNode();if(l)for(var a=0;t.id===n.id||0<s.getChannels(t.id,n.id).length&&a<s._channels.length;)t=s.getRandomNode(),n=s.getRandomNode(),a++;var r=v(4),o=v(4);r=r||o?r:v(4)+1;var i={source:t.id,target:n.id,sourceBalance:r,targetBalance:o};return i.id=s._getUniqueChannelId(i),i})}},{key:"getRandomChannel",value:function(){return this._channels[v(this._channels.length)]}},{key:"getChannelCount",value:function(){return this._channels.length}},{key:"removeChannel",value:function(a,r){var o=this;return this._channels=this._channels.filter(function(e){if(e.source.id!==a||e.target.id!==r)return!0;var t=o._getNodeById(a);t.balance+=e.sourceBalance,t.offchainBalance-=e.sourceBalance;var n=o._getNodeById(r);return n.balance+=e.targetBalance,n.offchainBalance-=e.targetBalance,!1}),console.log("removeChannel: ",this._channels),this._updateNodes(),this._updateChannels(),this}},{key:"getChannels",value:function(t,n){return this._channels.filter(function(e){return e.source.id===t&&e.target.id===n||e.target.id===t&&e.source.id===n})}},{key:"changeChannelSourceBalance",value:function(e,t,n){var a=this.getChannels(e,t);if(!a||a.length<=0)return console.error('no channel found between "'+e+'" and "'+t+'"'),this;var r=a[0],o=this._getNodeById(r.source.id);if(0<n){if(n=Math.abs(n),o.balance<n)return console.error("node "+e+" has not enough balance ("+o.balance+") to refund the channel by "+n),this;o.balance-=n,o.offchainBalance+=n,r.sourceBalance+=n}else{if(n=Math.abs(n),r.sourceBalance<n)return console.error("sourceBalance ("+e+") is not enough ("+r.sourceBalance+") to remove an amount of "+n),this;o.balance+=n,o.offchainBalance-=n,r.sourceBalance-=n}return this._updateNodes(),this._updateChannels(),this}},{key:"changeChannelTargetBalance",value:function(e,t,n){var a=this.getChannels(e,t);if(!a||a.length<=0)return console.error('no channel found between "'+e+'" and "'+t+'"'),this;var r=a[0],o=this._getNodeById(r.target.id);if(0<n){if(n=Math.abs(n),o.balance<n)return console.error("node "+t+" has not enough balance ("+o.balance+") to refund the channel by "+n),this;o.balance-=n,o.offchainBalance+=n,r.targetBalance+=n}else{if(n=Math.abs(n),r.targetBalance<n)return console.error("targetBalance ("+t+") is not enough ("+r.targetBalance+") to remove an amount of "+n),this;o.balance+=n,o.offchainBalance-=n,r.targetBalance-=n}return this._updateNodes(),this._updateChannels(),this}},{key:"highlightChannel",value:function(e,t,n){return this.getChannels(e,t).forEach(function(e){return e.hightlighted=n||!e.hightlighted}),this._updateChannels(),this}},{key:"_positionBeat",value:function(e,t){var n=d3.select(e),a=t.index,r=+n.attr("channel-state"),o=d3.select(n.node().parentNode.parentNode),i=o.select(".path").node(),s=o.data()[0],l=s.sourceBalance+s.targetBalance,c=this._opt.beads.distance+this._opt.beads.spacing,h=this._opt.beads.firstPosition+this._opt.beads.spacing,d=h+a*c,u=h+(l-1-a)*c,f=i.getTotalLength()-d-u,g=i.getPointAtLength(d+r*f);return"translate("+g.x+","+g.y+")"}},{key:"_ticked",value:function(){this._nodeElements&&this._nodeElements.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),this._paths&&this._paths.attr("d",function(e){return"M"+e.source.x+","+e.source.y+" "+e.target.x+","+e.target.y}),this.tickedBeads()}},{key:"tickedBeads",value:function(){var t=this;this.beadElements&&0!==this.beadElements.length&&!this.beadElements.empty()&&this.beadElements.attr("transform",function(e){return t._positionBeat(this,e)})}},{key:"animateBead",value:function(e,t,n){var a=this;return t=!!t,d3.select(e).transition().delay(n).ease(d3.easeQuadInOut).duration(1e3).attrTween("channel-state",function(e){return function(e){return a.tickedBeads(),t?1-e:e}})}},{key:"moveBeads",value:function(e,t,n,r){var o=this.getChannels(e,t)[0];if(o){var i=d3.select("#"+o.id);if(o.source.id===e){var s=o.sourceBalance,l=o.targetBalance,c=s-n,h=c+n-1,d=this,u=0;i.selectAll(".bead").each(function(a,e){if(c<=e&&e<=h){var t=100*(h-e);u++,d.animateBead(this,a.state,t).on("end",function(e,t,n){if(s--,l++,a.state=1,o.sourceBalance=s,o.source.offchainBalance--,o.targetBalance=l,o.target.offchainBalance++,d._updateChannels(),d._updateNodes(),i.attr("source-balance",s).attr("target-balance",l),d._opt.channels.showBalance&&i.select(".channel-text-path").text(s+":"+l),--u<=0)return r&&r()})}})}else{var f=o.sourceBalance,g=o.targetBalance,p=f+g-g,y=p+n-1,v=this,m=0;i.selectAll(".bead").each(function(a,e){if(p<=e&&e<=y){var t=100*e;m++,v.animateBead(this,a.state,t).on("end",function(e,t,n){if(f++,g--,a.state=0,o.sourceBalance=f,o.source.offchainBalance++,o.targetBalance=g,o.target.offchainBalance--,v._updateChannels(),v._updateNodes(),i.attr("source-balance",f).attr("target-balance",g),v._opt.channels.showBalance&&i.select(".channel-text-path").text(f+":"+g),--m<=0)return r&&r()})}})}return this}console.error("no channel found!")}},{key:"_onDragStart",value:function(e){d3.event.active||this.simulation.alphaTarget(.1).restart(),e.fx=e.x,e.fy=e.y}},{key:"_onDragged",value:function(e){e.fx=d3.event.x,e.fy=d3.event.y}},{key:"_onDragendEnd",value:function(e){d3.event.active||this.simulation.alphaTarget(0),e.fx=null,e.fy=null}},{key:"_initializePresentation",value:function(){this._opt.presentation&&this._opt.presentation.steps&&0<this._opt.presentation.steps.length?(this.presentation={currentState:0,steps:this._opt.presentation.steps},this.presentation.steps.forEach(function(e){e.forEach(function(e){var t=m[e.cmd];t?e.args&&0!==e.args.length&&e.args.length===t.numArgs||console.error("the command "+e.cmd+" requires exactly "+t.numArgs+" arguments!"):console.error("invalid command "+e.cmd+"!")})})):console.error("presentation must be an object that contains one or more steps")}},{key:"nextStep",value:function(){if(!this.presentation){var e="not in presentation mode! please pass a presentation object when creating the beadnet.";return console.log(e),e}if(this.presentation.currentState>=this.presentation.steps.length){var t="presentation reached its end. please restart it.";return console.log(t),t}var n=this.presentation.steps[this.presentation.currentState],a="";"string"==typeof n[0]&&(a=n.shift());var r=this;return n.forEach(function(e){var t=m[e.cmd];r[t.fnName].apply(r,e.args)}),this.presentation.currentState++,a}}]),n}()});
//# sourceMappingURL=beadnet.standalone.min.js.map
